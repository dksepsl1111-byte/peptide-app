<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í©íƒ€ì´ë“œ ë§¤ë‹ˆì €</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .active-tab { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div class="max-w-md mx-auto min-h-screen flex flex-col pb-20">
        <header class="p-6 bg-white shadow-sm font-bold text-xl flex items-center gap-2">
            ğŸ’‰ í©íƒ€ì´ë“œ ë‹¤ì´ì–´ë¦¬
        </header>

        <main class="p-4 space-y-4">
            <div id="alarm-section" class="flex gap-2 overflow-x-auto pb-2"></div>

            <div id="record" class="tab-content active space-y-4">
                <div class="bg-white p-5 rounded-3xl shadow-sm space-y-4">
                    <h3 class="font-bold text-slate-700 underline">ì£¼ì‚¬ ê¸°ë¡ ì…ë ¥</h3>
                    <input type="date" id="inj-date" class="w-full p-3 bg-slate-100 rounded-xl border-none">
                    <select id="inj-type" class="w-full p-3 bg-slate-100 rounded-xl">
                        <option value="mounjaro">ë§ˆìš´ìë¡œ (7ì¼ ì£¼ê¸°)</option>
                        <option value="tesamorelin">í…Œì‚¬ëª¨ë ë¦° (1ì¼ ì£¼ê¸°)</option>
                        <option value="retatrutide">ë ˆíƒ€íŠ¸ë£¨íƒ€ì´ë“œ (7ì¼ ì£¼ê¸°)</option>
                    </select>
                    <select id="inj-vial" class="w-full p-3 bg-blue-50 rounded-xl text-blue-600 font-bold">
                        <option value="">ë¨¼ì € ì¬ê³ ë¥¼ ë“±ë¡í•˜ì„¸ìš”</option>
                    </select>
                    <input type="number" id="inj-dose" placeholder="ìš©ëŸ‰(mg) ì…ë ¥" class="w-full p-3 bg-slate-100 rounded-xl">
                    <button onclick="saveInjection()" class="w-full bg-blue-600 text-white p-4 rounded-2xl font-bold shadow-lg">ê¸°ë¡ ì €ì¥</button>
                </div>

                <div class="bg-white p-5 rounded-3xl shadow-sm space-y-3">
                    <h3 class="font-bold text-slate-700">ì²´ì¤‘ ì…ë ¥</h3>
                    <div class="flex gap-2">
                        <input type="number" id="weight-input" placeholder="00.0" class="flex-1 p-3 bg-slate-100 rounded-xl border-none font-bold">
                        <button onclick="saveWeight()" class="bg-green-500 text-white px-6 rounded-xl font-bold">ì €ì¥</button>
                    </div>
                </div>
            </div>

            <div id="inventory" class="tab-content space-y-4">
                <div class="bg-white p-5 rounded-3xl shadow-sm">
                    <h3 class="font-bold mb-4">ìƒˆ ì£¼ì‚¬ê¸° ë“±ë¡</h3>
                    <button onclick="addVial()" class="w-full p-4 border-2 border-dashed border-slate-300 rounded-2xl text-slate-400 font-bold">+ ì£¼ì‚¬ê¸° ì¶”ê°€ (ì„ íƒëœ ì¢…ë¥˜)</button>
                </div>
                <div id="vial-list" class="space-y-3"></div>
            </div>

            <div id="weight" class="tab-content space-y-4">
                <div class="bg-white p-8 rounded-[40px] shadow-sm text-center">
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">ì´ ê°ëŸ‰ ìˆ˜ì¹˜</p>
                    <h2 id="total-loss" class="text-5xl font-black text-blue-600 mt-2">0.0kg</h2>
                </div>
                <div id="weight-list" class="bg-white p-4 rounded-2xl shadow-sm space-y-2 max-h-64 overflow-y-auto"></div>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-3 max-w-md mx-auto">
            <button onclick="showTab('record')" class="nav-item p-2 font-bold text-blue-500">ê¸°ë¡</button>
            <button onclick="showTab('inventory')" class="nav-item p-2 font-bold text-slate-300">ì¬ê³ </button>
            <button onclick="showTab('weight')" class="nav-item p-2 font-bold text-slate-300">í†µê³„</button>
        </nav>
    </div>

    <script>
        [cite_start]// ë°ì´í„° ì´ˆê¸°í™” [cite: 10]
        let data = JSON.parse(localStorage.getItem('peptide_data')) || { injections: [], weights: [], inventory: [] };
        const cycles = { mounjaro: 7, tesamorelin: 1, retatrutide: 7 };

        function updateUI() {
            [cite_start]localStorage.setItem('peptide_data', JSON.stringify(data)); [cite: 11]
            renderAlarms();
            renderVialSelect();
            renderVialList();
            renderWeightInfo();
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('text-blue-500');
                el.classList.add('text-slate-300');
            });
            event.currentTarget.classList.add('text-blue-500');
        }

        function renderAlarms() {
            const alarmSection = document.getElementById('alarm-section');
            alarmSection.innerHTML = '';
            const types = ['mounjaro', 'tesamorelin', 'retatrutide'];
            
            types.forEach(type => {
                const injs = data.injections.filter(i => i.peptide === type);
                if (injs.length > 0) {
                    const last = injs[injs.length - 1];
                    const nextDate = new Date(last.date);
                    [cite_start]nextDate.setDate(nextDate.getDate() + cycles[type]); [cite: 29]
                    const diff = Math.ceil((nextDate - new Date()) / 86400000);
                    
                    const div = document.createElement('div');
                    div.className = `min-w-[120px] p-4 rounded-2xl shadow-sm border-b-4 ${diff <= 0 ? 'bg-red-500 border-red-700 text-white' : 'bg-white border-blue-500'}`;
                    div.innerHTML = `<p class="text-[10px] font-bold opacity-70">${type.toUpperCase()}</p><h2 class="text-lg font-black">${diff <= 0 ? 'D-DAY' : 'D-'+diff}</h2>`;
                    alarmSection.appendChild(div);
                }
            });
        }

        function addVial() {
            const type = document.getElementById('inj-type').value;
            const size = type === 'mounjaro' ? 60 : type === 'tesamorelin' ? [cite_start]10 : 30; [cite: 3]
            [cite_start]data.inventory.push({ id: Date.now(), peptide: type, remaining: size, total: size }); [cite: 13]
            updateUI();
            alert('ì£¼ì‚¬ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function renderVialSelect() {
            const select = document.getElementById('inj-vial');
            const type = document.getElementById('inj-type').value;
            const available = data.inventory.filter(v => v.peptide === type && v.remaining > 0);
            
            select.innerHTML = available.length ? '' : '<option value="">ì¬ê³  ì—†ìŒ</option>';
            available.forEach(v => {
                select.innerHTML += `<option value="${v.id}">${v.remaining.toFixed(1)}mg ë‚¨ìŒ</option>`;
            });
        }

        function saveInjection() {
            const date = document.getElementById('inj-date').value;
            const type = document.getElementById('inj-type').value;
            const vialId = document.getElementById('inj-vial').value;
            [cite_start]const dose = parseFloat(document.getElementById('inj-dose').value); [cite: 17]

            if(!date || !vialId || !dose) return alert('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

            const vial = data.inventory.find(v => v.id == vialId);
            [cite_start]if(vial.remaining < dose) return alert('ì¬ê³  ìš©ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.'); [cite: 16]

            [cite_start]vial.remaining -= dose; [cite: 18]
            [cite_start]data.injections.push({ date, peptide: type, dose, id: Date.now() }); [cite: 17]
            updateUI();
            alert('ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function saveWeight() {
            [cite_start]const weight = parseFloat(document.getElementById('weight-input').value); [cite: 23]
            const date = new Date().toISOString().split('T')[0];
            if(weight) {
                [cite_start]data.weights.push({ date, weight, id: Date.now() }); [cite: 23]
                updateUI();
                document.getElementById('weight-input').value = '';
                alert('ì²´ì¤‘ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function renderVialList() {
            const list = document.getElementById('vial-list');
            list.innerHTML = '';
            data.inventory.forEach(v => {
                [cite_start]const pct = (v.remaining / v.total) * 100; [cite: 53]
                list.innerHTML += `
                    <div class="bg-white p-4 rounded-2xl shadow-sm">
                        <div class="flex justify-between font-bold text-sm mb-2">
                            <span>${v.peptide.toUpperCase()}</span>
                            <span>${v.remaining.toFixed(1)}/${v.total}mg</span>
                        </div>
                        <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                            <div class="bg-blue-500 h-full" style="width:${pct}%"></div>
                        </div>
                    </div>`;
            });
        }

        function renderWeightInfo() {
            const lossEl = document.getElementById('total-loss');
            const list = document.getElementById('weight-list');
            if(data.weights.length > 1) {
                [cite_start]const loss = data.weights[0].weight - data.weights[data.weights.length-1].weight; [cite: 121]
                lossEl.innerText = loss.toFixed(1) + 'kg';
            }
            list.innerHTML = data.weights.slice().reverse().map(w => `
                <div class="flex justify-between p-2 border-b text-sm">
                    <span>${w.date}</span><span class="font-bold">${w.weight}kg</span>
                </div>`).join('');
        }

        // ì´ˆê¸° ì‹¤í–‰
        document.getElementById('inj-date').value = new Date().toISOString().split('T')[0];
        document.getElementById('inj-type').addEventListener('change', renderVialSelect);
        updateUI();
    </script>
</body>
</html>
